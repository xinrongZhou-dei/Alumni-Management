import{_ as S,a as $,u as B,r as p,o as L,d as o,e as w,f as x,g as t,w as n,q,k as v,n as U,h as z,i as A,j as f,F as I,m as F}from"./index-fee6fb78.js";import{u as H,a as R}from"./emailTemplate-8aa76c0b.js";const W={class:"email-template-add"},j={class:"variable-list"},D={class:"button-container"},J={__name:"EmailTemplateAdd",setup(O){const c=$(),b=B(),_=p(0),s=p(window.innerWidth<=768);window.addEventListener("resize",()=>{s.value=window.innerWidth<=768});const a=p({templateName:"",theme:"",targetType:b.query.target_type||"",content:""}),g=b.query.id,V=[{name:"alumnus.alumni_id",desc:"校友ID"},{name:"activity.name",desc:"活动名称"},{name:"activity.detail",desc:"活动详情"},{name:"alumnus.chinese_name",desc:"中文姓名"},{name:"alumnus.email",desc:"邮箱"},{name:"alumnus.contact_number",desc:"联系电话"},{name:"alumnus.ycyw_schools_attended",desc:"就读学校"},{name:"alumnus.first_name",desc:"英文名"},{name:"alumnus.last_name",desc:"英文姓"}],T=i=>{const e=document.querySelector("textarea");if(e){const r=e.selectionStart,d=e.selectionEnd,m=a.value.content;a.value.content=m.slice(0,r)+`{{${i}}}`+m.slice(d),setTimeout(()=>{e.selectionStart=e.selectionEnd=r+`{{${i}}}`.length,e.focus()},0)}else a.value.content+=`{{${i}}}`},k=async()=>{g?await H(g,a.value):await R(a.value),c.back()},h=()=>{c.back()},E=()=>{c.push({name:"EmailTemplateManage"})};return L(()=>{const i=JSON.parse(sessionStorage.getItem("admin_permissions")||"{}");_.value=i.email_template_permission||0,_.value===1&&(a.value.targetType="alumni")}),(i,e)=>{const r=o("el-icon"),d=o("el-button"),m=o("el-input"),u=o("el-form-item"),y=o("el-option"),C=o("el-select"),N=o("el-tag"),M=o("el-form");return w(),x("div",W,[t(d,{type:"text",onClick:E,class:"back-btn",style:q(s.value?"position: static; margin-bottom: 16px;":"")},{default:n(()=>[t(r,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:n(()=>[t(z(A))]),_:1}),e[4]||(e[4]=f("返回 "))]),_:1,__:[4]},8,["style"]),v("h2",{class:U({"mobile-title":s.value})},"添加邮件模版",2),t(M,{model:a.value,"label-width":s.value?"80px":"100px","label-position":s.value?"top":"right",class:"template-form"},{default:n(()=>[t(u,{label:"模版名称"},{default:n(()=>[t(m,{modelValue:a.value.templateName,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.templateName=l),maxlength:"100"},null,8,["modelValue"])]),_:1}),t(u,{label:"主题"},{default:n(()=>[t(m,{modelValue:a.value.theme,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.theme=l),maxlength:"100"},null,8,["modelValue"])]),_:1}),t(u,{label:"目标对象"},{default:n(()=>[t(C,{modelValue:a.value.targetType,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.targetType=l),placeholder:"请选择对象",disabled:_.value===1,style:{width:"100%"}},{default:n(()=>[t(y,{label:"校友",value:"alumni"}),t(y,{label:"管理员",value:"admin"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(u,{label:"内容"},{default:n(()=>[t(m,{type:"textarea",modelValue:a.value.content,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.content=l),rows:s.value?6:8,placeholder:"可插入变量，如{{alumni_id}}"},null,8,["modelValue","rows"])]),_:1}),t(u,{label:"可用变量",class:"variable-container"},{default:n(()=>[v("div",j,[(w(),x(I,null,F(V,l=>t(N,{key:l.name,onClick:P=>T(l.name),class:"variable-tag",innerHTML:`{{${l.name}}}：${l.desc}`},null,8,["onClick","innerHTML"])),64))])]),_:1}),t(u,{class:"form-buttons"},{default:n(()=>[v("div",D,[t(d,{type:"primary",onClick:k,class:"form-btn"},{default:n(()=>e[5]||(e[5]=[f("保存")])),_:1,__:[5]}),t(d,{onClick:h,class:"form-btn"},{default:n(()=>e[6]||(e[6]=[f("取消")])),_:1,__:[6]})])]),_:1})]),_:1},8,["model","label-width","label-position"])])}}},Q=S(J,[["__scopeId","data-v-d2046686"]]);export{Q as default};
