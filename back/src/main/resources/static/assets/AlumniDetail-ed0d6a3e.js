import{_ as ae,u as le,a as te,r as p,c as ie,o as se,b,d as $,e as s,f as u,g as r,w as d,h as o,i as ne,j as y,E as _,k as l,l as N,F as w,m as x,t as v,n as c,p as P,q as oe,s as ue,v as h,x as re,y as de,z as f}from"./index-fee6fb78.js";const ve={class:"alumni-edit"},fe={class:"card-header"},ce={key:0,class:"review-actions"},me={key:0},pe={class:"form-section"},ye={class:"info-grid"},ge={class:"info-label"},be={class:"form-section"},_e={key:0,style:{color:"#888"}},he={class:"info-item"},Ie={class:"info-item"},ke={class:"info-item"},we={class:"info-item"},Ce={class:"info-item"},Ne={class:"form-section"},xe={key:0,style:{color:"#888"}},Me={class:"info-item"},Ae={class:"info-item"},Se={class:"info-item"},Te={class:"info-item"},Re={key:0,class:"form-section"},je={key:2},ze={key:1,style:{color:"#888"}},De={__name:"AlumniDetail",setup(Ee){const M=le(),I=te(),a=p(null),A=p([]),S=p([]),j=p(!0),T=p({}),R=p({}),C=p(!1),k=p([]),W=ie(()=>{var i,e,n,g,t,m,z,D,E,V,q,B,G,L,F,O;return[{label:"Alumni ID",value:(i=a.value)==null?void 0:i.alumniId},{label:"称谓",value:(e=a.value)==null?void 0:e.salutation},{label:"英文姓名",value:a.value?a.value.firstName+"/"+a.value.lastName:""},{label:"中文姓名",value:(n=a.value)==null?void 0:n.chineseName},{label:"电子邮箱",value:(g=a.value)==null?void 0:g.email},{label:"联系电话",value:(t=a.value)==null?void 0:t.contactNumber},{label:"出生日期",value:(m=a.value)==null?void 0:m.birthday},{label:"微信ID",value:(z=a.value)==null?void 0:z.wechatId},{label:"通讯地址",value:(D=a.value)==null?void 0:D.correspondenceAddress},{label:"当前所在地",value:(E=a.value)==null?void 0:E.currentLocation},{label:"Zoho校友编号",value:(V=a.value)==null?void 0:V.zohoAlumniNumber},{label:"身份类型",value:(q=a.value)==null?void 0:q.affiliation},{label:"就读学校",value:(B=a.value)==null?void 0:B.ycywSchoolsAttended},{label:"所在地区",value:(G=a.value)==null?void 0:G.region},{label:"就读时间",value:a.value?a.value.studyPeriodStart+" ~ "+a.value.studyPeriodEnd:""},{label:"最后在校日期",value:(L=a.value)==null?void 0:L.lastSchoolDay},{label:"婚姻状况",value:(F=a.value)==null?void 0:F.maritalStatus},{label:"信息更新时间",value:(O=a.value)==null?void 0:O.updateTime}]});async function Y(){const i=await b.get("/api/tag/list",{params:{page:1,pageSize:1e3}});if(i.data.code===0){T.value={},R.value={};for(const e of i.data.data.rows)T.value[e.id]=e.name,R.value[e.id]=e.color}}function U(i){return i?i.split(",").map(n=>n.trim()).filter(Boolean).map(n=>({id:n,name:T.value[n],color:R.value[n]})):[]}function Z(i){if(!i)return"#fff";const e=i.startsWith("#")?H(i):[64,158,255];return e[0]*.299+e[1]*.587+e[2]*.114>186?"#333":"#fff"}function H(i){let e=i.substring(1);e.length===3&&(e=e.split("").map(g=>g+g).join(""));const n=parseInt(e,16);return[n>>16&255,n>>8&255,n&255]}se(async()=>{const i=M.params.id;try{const e=await b.get(`/api/register/alumni-detail/${i}`);e.data.code===0&&e.data.data&&(a.value=e.data.data.alumni,A.value=e.data.data.tertiary_information||[],S.value=e.data.data.carrer_information||[]),await Y()}finally{j.value=!1}});function J(){M.query.from==="/alumni/review"?I.push("/alumni/review"):I.push("/alumni/manage")}async function K(){if(!a.value)return;const i={chineseName:a.value.chineseName,englishName:(a.value.firstName||"")+(a.value.lastName||""),birthday:a.value.birthday};try{const e=await b.post("/api/register/match-gmi",i);e.data.code===0?(k.value=e.data.data||[],C.value=!0):f.error(e.data.msg||"匹配失败")}catch{f.error("网络错误，匹配失败")}}function Q(){!a.value||!a.value.alumniId||(f.info("正在提交审核..."),b.post("/api/register/audit-approve",{alumniId:a.value.alumniId}).then(i=>{i.data.code===0?(f.success("审核通过，已激活！"),I.push({path:"/email/send",query:{alumniId:a.value.alumniId,from:"review"}})):f.error(i.data.msg||"审核失败")}).catch(()=>{f.error("网络错误，审核失败")}))}function X(){!a.value||!a.value.alumniId||(f.info("正在提交审核拒绝..."),b.post("/api/register/audit-reject",{alumniId:a.value.alumniId}).then(i=>{i.data.code===0?(f.success("审核已拒绝，已归档！"),I.push({path:"/email/send",query:{alumniId:i.data.newAlumniId,from:"review"}})):f.error(i.data.msg||"审核拒绝失败")}).catch(()=>{f.error("网络错误，审核拒绝失败")}))}async function ee(i){try{const e=await b.post("/api/register/match-and-activate",{gmiAlumniId:i.alumniId,reviewAlumniId:a.value.alumniId});e.data.code===0?(f.success("匹配成功，已激活并删除原GMI数据！"),k.value=k.value.filter(n=>n.alumniId!==i.alumniId),I.push({path:"/email/send",query:{alumniId:a.value.alumniId,from:"review"}})):f.error(e.data.msg||"操作失败")}catch{f.error("网络错误，操作失败")}}return(i,e)=>{const n=$("el-icon"),g=$("el-card");return s(),u("div",ve,[r(o(_),{type:"text",onClick:J,class:"back-btn"},{default:d(()=>[r(n,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:d(()=>[r(o(ne))]),_:1}),e[2]||(e[2]=y("返回 "))]),_:1,__:[2]}),r(g,{class:"edit-card"},{header:d(()=>[l("div",fe,[e[6]||(e[6]=l("span",{class:"header-title"},"校友详细信息",-1)),o(M).query.from==="/alumni/review"&&a.value&&a.value.state!==3?(s(),u("div",ce,[r(o(_),{type:"primary",onClick:K,class:"review-btn"},{default:d(()=>e[3]||(e[3]=[y("匹配GMIS数据")])),_:1,__:[3]}),r(o(_),{type:"success",onClick:Q,class:"review-btn"},{default:d(()=>e[4]||(e[4]=[y("审核通过")])),_:1,__:[4]}),r(o(_),{type:"danger",onClick:X,class:"review-btn"},{default:d(()=>e[5]||(e[5]=[y("审核拒绝")])),_:1,__:[5]})])):N("",!0)])]),default:d(()=>[j.value?(s(),u("div",me,"加载中...")):a.value?(s(),u(w,{key:1},[l("div",pe,[e[7]||(e[7]=l("div",{class:"section-title"},"基本信息",-1)),l("div",ye,[(s(!0),u(w,null,x(W.value,(t,m)=>(s(),u("div",{class:"info-item",key:m},[l("div",ge,v(t.label),1),l("div",{class:c(["info-value",t.value?"info-value-filled":"info-value-empty"])},v(t.value||"-"),3)]))),128))])]),l("div",be,[e[13]||(e[13]=l("div",{class:"section-title"},"教育信息",-1)),A.value.length===0?(s(),u("div",_e,"暂无学籍信息")):N("",!0),(s(!0),u(w,null,x(A.value,(t,m)=>(s(),u("div",{key:m,class:"info-grid"},[l("div",he,[e[8]||(e[8]=l("div",{class:"info-label"},"大学/学院",-1)),l("div",{class:c(["info-value",t.universityCollege?"info-value-filled":"info-value-empty"])},v(t.universityCollege||"-"),3)]),l("div",Ie,[e[9]||(e[9]=l("div",{class:"info-label"},"学位",-1)),l("div",{class:c(["info-value",t.degree?"info-value-filled":"info-value-empty"])},v(t.degree||"-"),3)]),l("div",ke,[e[10]||(e[10]=l("div",{class:"info-label"},"专业",-1)),l("div",{class:c(["info-value",t.major?"info-value-filled":"info-value-empty"])},v(t.major||"-"),3)]),l("div",we,[e[11]||(e[11]=l("div",{class:"info-label"},"毕业年份",-1)),l("div",{class:c(["info-value",t.graduationYear?"info-value-filled":"info-value-empty"])},v(t.graduationYear||"-"),3)]),l("div",Ce,[e[12]||(e[12]=l("div",{class:"info-label"},"国家/地区",-1)),l("div",{class:c(["info-value",t.countryRegion?"info-value-filled":"info-value-empty"])},v(t.countryRegion||"-"),3)])]))),128))]),l("div",Ne,[e[18]||(e[18]=l("div",{class:"section-title"},"工作信息",-1)),S.value.length===0?(s(),u("div",xe,"暂无工作经历")):N("",!0),(s(!0),u(w,null,x(S.value,(t,m)=>(s(),u("div",{key:m,class:"info-grid"},[l("div",Me,[e[14]||(e[14]=l("div",{class:"info-label"},"公司/组织",-1)),l("div",{class:c(["info-value",t.companyOrganization?"info-value-filled":"info-value-empty"])},v(t.companyOrganization||"-"),3)]),l("div",Ae,[e[15]||(e[15]=l("div",{class:"info-label"},"职位",-1)),l("div",{class:c(["info-value",t.jobTitle?"info-value-filled":"info-value-empty"])},v(t.jobTitle||"-"),3)]),l("div",Se,[e[16]||(e[16]=l("div",{class:"info-label"},"行业",-1)),l("div",{class:c(["info-value",t.industry?"info-value-filled":"info-value-empty"])},v(t.industry||"-"),3)]),l("div",Te,[e[17]||(e[17]=l("div",{class:"info-label"},"国家/地区",-1)),l("div",{class:c(["info-value",t.countryRegion?"info-value-filled":"info-value-empty"])},v(t.countryRegion||"-"),3)])]))),128))]),a.value.tagIds?(s(),u("div",Re,[e[19]||(e[19]=l("div",{class:"section-title"},"标签",-1)),l("div",null,[(s(!0),u(w,null,x(U(a.value.tagIds),t=>(s(),P(o(ue),{key:t.id,style:oe({backgroundColor:t.color||"#409eff",color:Z(t.color),border:"none",fontWeight:"bold",fontSize:"1rem",padding:"0 14px",marginRight:"6px",marginBottom:"6px"}),effect:"plain"},{default:d(()=>[y(v(t.name),1)]),_:2},1032,["style"]))),128))])])):N("",!0)],64)):(s(),u("div",je,"未找到该校友信息"))]),_:1}),r(o(de),{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),title:"GMI数据匹配结果",width:"60%","close-on-click-modal":!1},{footer:d(()=>[r(o(_),{onClick:e[0]||(e[0]=t=>C.value=!1)},{default:d(()=>e[21]||(e[21]=[y("关闭")])),_:1,__:[21]})]),default:d(()=>[k.value.length?(s(),P(o(re),{key:0,data:k.value},{default:d(()=>[r(o(h),{prop:"alumniId",label:"学号"}),r(o(h),{prop:"chineseName",label:"中文姓名"}),r(o(h),{label:"英文姓名"},{default:d(t=>[y(v(t.row.firstName)+"/"+v(t.row.lastName),1)]),_:1}),r(o(h),{prop:"birthday",label:"出生日期"}),r(o(h),{prop:"email",label:"邮箱"}),r(o(h),{label:"操作"},{default:d(t=>[r(o(_),{type:"success",size:"small",onClick:m=>ee(t.row)},{default:d(()=>e[20]||(e[20]=[y("匹配")])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(s(),u("div",ze,"未匹配到任何GMI数据"))]),_:1},8,["modelValue"])])}}},qe=ae(De,[["__scopeId","data-v-71e72cd6"]]);export{qe as default};
