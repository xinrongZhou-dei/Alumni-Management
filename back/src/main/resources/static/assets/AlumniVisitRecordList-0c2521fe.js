import{_ as z,a as K,r as p,o as Z,Z as $,d as u,a3 as X,e as _,f as I,g as a,w as s,a4 as ee,z as d,h as le,i as ae,j as g,k as V,a5 as te,p as k,t as Y,l as oe,F as T,m as C,$ as se,a0 as ne}from"./index-fee6fb78.js";const ue={class:"visit-record-list"},ie={class:"dialog-footer"},re={__name:"AlumniVisitRecordList",setup(de){const D=K(),f=p(!1),b=p(!1),N=p([]),t=p({}),c=p(null),h={visitSchool:[{required:!0,message:"请选择校区",trigger:"change"}],visitDay:[{required:!0,message:"请选择日期",trigger:"change"}],visitTime:[{required:!0,message:"请选择时间段",trigger:"change"}],remark:[{required:!0,message:"请输入备注信息",trigger:"blur"}]},R=[{value:"YCIS_HK",label:"YCIS Hong Kong - 耀中国际学校（香港）"},{value:"YCIS_BJ",label:"YCIS Beijing - 耀中国际学校（北京）"},{value:"YCIS_CQ",label:"YCIS Chongqing - 耀中国际学校（重庆）"},{value:"YCIS_QD",label:"YCIS Qingdao - 耀中国际学校（青岛）"},{value:"YCIS_SH",label:"YCIS Shanghai - 耀中国际学校（上海）"},{value:"YWIES_BJ",label:"YWIES Beijing - 耀华国际教育学校（北京）"},{value:"YWIES_GZ",label:"YWIES Guangzhou - 耀华国际教育学校（广州）"},{value:"YWIES_SH_GB",label:"YWIES Shanghai Gubei - 耀华国际教育学校（上海古北）"},{value:"YWIES_SH_LG",label:"YWIES Shanghai Lingang - 耀华国际教育学校（上海临港）"},{value:"YWIES_TX",label:"YWIES Tongxiang - 耀华国际教育学校（桐乡）"},{value:"YWIES_YT",label:"YWIES Yantai - 耀华国际教育学校（烟台）"}],U=[{value:"MORNING",label:"上午 (9:00-11:30)"},{value:"AFTERNOON",label:"下午 (13:30-16:00)"}],G=o=>{const e=new Date;e.setHours(0,0,0,0);const i=new Date(e);i.setDate(i.getDate()+1);const n=new Date(e);return n.setDate(n.getDate()+7),o.getTime()<i.getTime()||o.getTime()>n.getTime()},P=o=>({PENDING:"warning",APPROVED:"success",REJECTED:"danger"})[o],W=o=>({PENDING:"待审核",APPROVED:"已批准",REJECTED:"已拒绝"})[o],x=o=>({MORNING:"上午(9:00-11:30)",AFTERNOON:"下午(13:30-16:00)"})[o],S=async()=>{f.value=!0;try{const o=sessionStorage.getItem("alumni_token");let e="";if(o)try{const n=JSON.parse(atob(o.split(".")[1]));n.alumni_id&&(e=n.alumni_id)}catch(n){console.warn("解析token失败:",n)}e||(e=JSON.parse(sessionStorage.getItem("user_info")||"{}").alumniId);const i=await ee(e);i.code===200?N.value=i.data:d.error(i.message||"获取预约记录失败")}catch(o){console.error("获取预约记录失败:",o),d.error("获取预约记录失败")}finally{f.value=!1}},M=async o=>{try{const e=await se(o.visitUUID);e.code===0||e.code===200?(sessionStorage.setItem("visit_record",JSON.stringify(e.data)),D.push("/visit-record/form")):d.error(e.message||"获取预约详情失败")}catch(e){console.error("获取预约详情失败:",e),d.error("获取预约详情失败")}},O=async()=>{try{const o=await ne({visitUUID:t.value.visitUUID,status:t.value.status,remark:t.value.remark});o.code===0?(d.success("修改成功"),b.value=!1,S()):d.error(o.message||"修改失败")}catch(o){console.error("修改失败:",o),d.error("修改失败")}},L=()=>{D.push("/")};function B(o){S()}function w(){const o=window.location.protocol==="https:"?"wss:":"ws:",e=window.location.host,i="/ws/database-updates";c.value=new WebSocket(o+"//"+e+i),c.value.onmessage=B,c.value.onclose=()=>{setTimeout(w,3e3)}}return Z(()=>{S(),w()}),$(()=>{c.value&&c.value.close()}),(o,e)=>{const i=u("el-icon"),n=u("el-button"),m=u("el-table-column"),A=u("el-tag"),H=u("el-table"),J=u("el-card"),v=u("el-input"),r=u("el-form-item"),y=u("el-option"),E=u("el-select"),q=u("el-date-picker"),F=u("el-form"),j=u("el-dialog"),Q=X("loading");return _(),I("div",ue,[a(n,{type:"text",onClick:L,class:"back-btn"},{default:s(()=>[a(i,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:s(()=>[a(le(ae))]),_:1}),e[10]||(e[10]=g("返回 "))]),_:1,__:[10]}),a(J,{class:"list-card"},{header:s(()=>e[11]||(e[11]=[V("div",{class:"card-header"},[V("span",null,"我的预约记录")],-1)])),default:s(()=>[te((_(),k(H,{data:N.value,onRowClick:M},{default:s(()=>[a(m,{label:"预约校区",prop:"visitSchool"}),a(m,{label:"预约日期",prop:"visitDay"}),a(m,{label:"预约时段",prop:"visitTime"},{default:s(l=>[g(Y(x(l.row.visitTime)),1)]),_:1}),a(m,{label:"预约状态",prop:"status"},{default:s(l=>[a(A,{type:P(l.row.status)},{default:s(()=>[g(Y(W(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(m,{label:"创建时间",prop:"createTime"})]),_:1},8,["data"])),[[Q,f.value]])]),_:1}),a(j,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l),title:"预约详情",width:"50%","close-on-click-modal":!1},{footer:s(()=>[V("span",ie,[a(n,{onClick:e[8]||(e[8]=l=>b.value=!1)},{default:s(()=>e[12]||(e[12]=[g("关闭")])),_:1,__:[12]}),t.value.status==="PENDING"?(_(),k(n,{key:0,type:"primary",onClick:O},{default:s(()=>e[13]||(e[13]=[g(" 保存修改 ")])),_:1,__:[13]})):oe("",!0)])]),default:s(()=>[a(F,{ref:"formRef",model:t.value,rules:h,"label-width":"120px",disabled:t.value.status!=="PENDING"},{default:s(()=>[a(r,{label:"校友姓名"},{default:s(()=>[a(v,{modelValue:t.value.chineseName,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.chineseName=l),disabled:!0},null,8,["modelValue"])]),_:1}),a(r,{label:"学号"},{default:s(()=>[a(v,{modelValue:t.value.alumniId,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.alumniId=l),disabled:!0},null,8,["modelValue"])]),_:1}),a(r,{label:"当前所在地"},{default:s(()=>[a(v,{modelValue:t.value.currentLocation,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.currentLocation=l),disabled:!0},null,8,["modelValue"])]),_:1}),a(r,{label:"联系方式"},{default:s(()=>[a(v,{modelValue:t.value.contactNumber,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.contactNumber=l),disabled:!0},null,8,["modelValue"])]),_:1}),a(r,{label:"预约校区",prop:"visitSchool"},{default:s(()=>[a(E,{modelValue:t.value.visitSchool,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.visitSchool=l),placeholder:"请选择校区",disabled:t.value.status!=="PENDING"},{default:s(()=>[(_(),I(T,null,C(R,l=>a(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1}),a(r,{label:"预约日期",prop:"visitDay"},{default:s(()=>[a(q,{modelValue:t.value.visitDay,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.visitDay=l),type:"date",placeholder:"请选择日期","disabled-date":G,"value-format":"YYYY-MM-DD",disabled:t.value.status!=="PENDING"},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"预约时段",prop:"visitTime"},{default:s(()=>[a(E,{modelValue:t.value.visitTime,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.visitTime=l),placeholder:"请选择时段",disabled:t.value.status!=="PENDING"},{default:s(()=>[(_(),I(T,null,C(U,l=>a(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","disabled"])]),_:1}),a(r,{label:"备注信息",prop:"remark"},{default:s(()=>[a(v,{modelValue:t.value.remark,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.remark=l),type:"textarea",rows:4,placeholder:"请输入备注信息",disabled:t.value.status!=="PENDING"},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue"])])}}},me=z(re,[["__scopeId","data-v-b7750699"]]);export{me as default};
