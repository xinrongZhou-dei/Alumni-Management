import{_ as P,a as R,u as T,r as t,o as U,A as V,d as g,e as j,f as F,g as s,w as r,k as u,b as S,B as O,z as i,C as W,D as G,h as H,i as J,j as x,t as q,G as K,H as Q,I as X}from"./index-fee6fb78.js";const Y={class:"page-root"},Z={class:"alumni-search-page"},$={class:"chapter-info"},ee={__name:"ChapterMemberList",setup(ae){const d=R(),k=T(),f=()=>{switch(sessionStorage.getItem("chapter_members_from")){case"home":d.push("/");break;case"my-chapters":sessionStorage.setItem("branch_list_view","my-chapters"),d.push("/alumni/branch-list");break;case"chapter-list":default:d.push("/alumni/branch-list");break}sessionStorage.removeItem("chapter_members_from")},m=t(k.params.chapterId),v=t("分会"),c=t({name:"",ycywSchoolsAttended:""}),b=t([]),y=t(0),o=t(1),h=t(10),p=JSON.parse(sessionStorage.getItem("user_info")||"{}"),w=t(""),l=t(null),B=async()=>{try{const e=await S.get("/api/chapters");if(e.data.success&&e.data.data){const a=e.data.data.find(_=>_.tagId==m.value);a&&(v.value=a.branchName)}}catch(e){console.error("获取分会名称失败:",e)}};async function n(e={}){try{const a=await O({...c.value,chapterId:m.value,pageNum:o.value,pageSize:h.value,...e});a.data&&(b.value=a.data.data||[],y.value=a.data.total||0)}catch(a){console.error("查询分会成员失败:",a),i.error("查询分会成员失败，请稍后重试")}}async function N(){if(p.alumniId)try{const e=await W(p.alumniId);e.data&&e.data.code===0&&(w.value=e.data.data.email||"")}catch(e){console.error("获取用户信息失败:",e)}}function M(e){o.value=1,Object.assign(c.value,e),n()}function z(){c.value={name:"",ycywSchoolsAttended:""},o.value=1,n()}function A(e){o.value=e,n()}function D(e){h.value=e,o.value=1,n()}const E=async()=>{try{await X.confirm("确定要退出该分会吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"});const e=await S.post("/api/chapters/leave",{alumniId:p.alumniId,tagId:m.value});e.data.success?(i.success("退出成功"),f()):i.error(e.data.msg||"退出失败")}catch(e){e!=="cancel"&&(console.error("退出分会失败",e),i.error("退出分会失败"))}};function L(){l.value=G({onMessage:e=>{const a=e.data;["alumni changed","tertiary changed","career changed","chapter changed"].includes(a)&&n()},onClose:()=>{}})}return U(async()=>{await B(),await n(),await N(),L()}),V(()=>{l.value&&l.value._manualClose&&l.value._manualClose()}),(e,a)=>{const _=g("el-icon"),C=g("el-button"),I=g("el-card");return j(),F("div",Y,[s(C,{type:"text",onClick:f,class:"back-btn"},{default:r(()=>[s(_,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:r(()=>[s(H(J))]),_:1}),a[0]||(a[0]=x("返回 "))]),_:1,__:[0]}),u("div",Z,[s(I,{class:"search-card",shadow:"hover"},{default:r(()=>[u("div",$,[u("h3",null,q(v.value)+" - 分会成员",1),s(C,{type:"danger",onClick:E,class:"leave-btn"},{default:r(()=>a[1]||(a[1]=[x("退出分会")])),_:1,__:[1]})]),s(K,{"model-value":c.value,onSearch:M,onReset:z},null,8,["model-value"])]),_:1}),s(I,{class:"table-card",shadow:"hover"},{default:r(()=>[a[2]||(a[2]=u("div",{class:"table-title"},"分会成员名录",-1)),s(Q,{data:b.value,total:y.value,"page-num":o.value,"page-size":h.value,"user-email":w.value,onPageChange:A,onPageSizeChange:D},null,8,["data","total","page-num","page-size","user-email"])]),_:1,__:[2]})])])}}},se=P(ee,[["__scopeId","data-v-103c2dbd"]]);export{se as default};
