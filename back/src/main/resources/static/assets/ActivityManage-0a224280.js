import{_ as K,a as Q,r as l,c as B,o as X,A as Z,d as u,e as x,p as k,w as n,b as I,D as tt,g as a,h as V,i as et,j as r,k as C,t as d,J as at,l as N,I as nt,z as L}from"./index-fee6fb78.js";const it={class:"activity-manage-header-flex"},st={class:"activity-manage-title"},ot={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-top":"16px"}},lt={__name:"ActivityManage",setup(ut){const y=Q(),v=l(!1),D=l({}),_=l(0),A=B(()=>_.value===2),j=()=>{y.push("../")},M=l([]),g=l(1),f=l(10),p=l(0),w=l([]),P=B(()=>p.value===0?0:(g.value-1)*f.value+1),R=B(()=>Math.min(g.value*f.value,p.value)),W=async()=>{try{const t=await I.get("/api/admin/permissions");t.data.code===0?(D.value=t.data.data,D.value.activity_management_permission!==void 0?_.value=D.value.activity_management_permission:_.value=0):(console.error("获取权限信息失败:",t.data.msg),_.value=0)}catch(t){console.error("获取权限信息出错:",t),_.value=0}},h=async()=>{try{const t=await I.get("/api/activity/list",{params:{page:g.value,size:f.value}});if(t.data&&t.data.code===0){const e={即将结束:0,进行中:1,未开始:2,已结束:3},c=(t.data.data||[]).slice().sort((s,m)=>{const o=e[s.signupStatus]??99,S=e[m.signupStatus]??99;if(o!==S)return o-S;const z=new Date(s.activityDate).getTime(),T=new Date(m.activityDate).getTime();return z-T});M.value=c,p.value=t.data.total||c.length,w.value=c}else M.value=[],w.value=[],p.value=0}catch(t){console.error("获取活动列表出错:",t),M.value=[],w.value=[],p.value=0}};function $(t){if(!t)return"";const e=new Date(t);if(isNaN(e.getTime()))return"";const c=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${c}-${s}-${m}`}const F=t=>{nt.confirm("确定要删除该活动吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=await I.delete(`/api/activity/delete/${t}`);e.data&&e.data.code===0?(L.success("删除成功"),h()):L.error(e.data.msg||"删除失败")}).catch(()=>{})},H=t=>{sessionStorage.setItem("activity_detail_from","admin"),y.push(`/admin/activity-detail/${t.uuid}`)},J=t=>{y.push(`/admin/activity-edit/${t.uuid}`)},O=()=>{y.push("/admin/activity-add")},U=t=>{g.value=t,h()},b=l(null);function Y(){b.value=tt({onMessage:t=>{const e=t.data;["activity changed","activity registration changed"].includes(e)&&h()},onClose:()=>{}})}return X(async()=>{const t=sessionStorage.getItem("activity_manage_from");v.value=t==="alumni",await W(),await h(),Y()}),Z(()=>{b.value&&b.value._manualClose&&b.value._manualClose()}),(t,e)=>{const c=u("el-icon"),s=u("el-button"),m=u("el-divider"),o=u("el-table-column"),S=u("el-tag"),z=u("el-space"),T=u("el-table"),q=u("el-pagination"),G=u("el-card");return x(),k(G,{class:"activity-manage-root",shadow:"hover"},{default:n(()=>[a(s,{type:"text",onClick:j,class:"back-btn"},{default:n(()=>[a(c,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:n(()=>[a(V(et))]),_:1}),e[0]||(e[0]=r("返回"))]),_:1,__:[0]}),C("div",it,[C("h2",st,d(v.value?"活动列表":"活动管理"),1),!v.value&&A.value?(x(),k(s,{key:0,class:"create-activity-btn",type:"primary",onClick:O},{default:n(()=>[a(c,{style:{"vertical-align":"middle","margin-right":"6px"}},{default:n(()=>[a(V(at))]),_:1}),e[1]||(e[1]=r(" 创建新活动 "))]),_:1,__:[1]})):N("",!0)]),a(m),a(T,{data:w.value,border:"",stripe:"",class:"activity-table"},{default:n(()=>[a(o,{prop:"name",label:"活动名称","min-width":"140"}),a(o,{prop:"activityDate",label:"活动时间","min-width":"120"},{default:n(i=>[r(d($(i.row.activityDate)),1)]),_:1}),a(o,{label:"报名起止时间","min-width":"180"},{default:n(i=>[r(d($(i.row.signupStart))+" ~ "+d($(i.row.signupEnd)),1)]),_:1}),a(o,{prop:"signupTotal",label:"报名人数","min-width":"100"}),a(o,{prop:"signupActual",label:"已报名人数","min-width":"100"}),a(o,{prop:"signupStatus",label:"报名状态","min-width":"110"},{default:n(i=>[a(S,{type:i.row.signupStatus==="进行中"?"success":i.row.signupStatus==="未开始"?"info":i.row.signupStatus==="即将结束"?"warning":"danger",effect:"light",round:""},{default:n(()=>[r(d(i.row.signupStatus),1)]),_:2},1032,["type"])]),_:1}),a(o,{label:"操作","min-width":"200"},{default:n(i=>[a(z,null,{default:n(()=>[a(s,{type:"primary",size:"small",onClick:E=>H(i.row)},{default:n(()=>e[2]||(e[2]=[r("查看")])),_:2,__:[2]},1032,["onClick"]),!v.value&&A.value?(x(),k(s,{key:0,type:"warning",size:"small",onClick:E=>J(i.row)},{default:n(()=>e[3]||(e[3]=[r("编辑")])),_:2,__:[3]},1032,["onClick"])):N("",!0),!v.value&&A.value?(x(),k(s,{key:1,type:"danger",size:"small",onClick:E=>F(i.row.uuid)},{default:n(()=>e[4]||(e[4]=[r("删除")])),_:2,__:[4]},1032,["onClick"])):N("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),C("div",ot,[C("div",null," 显示第"+d(P.value)+"到"+d(R.value)+"条，共"+d(p.value)+"条记录 ",1),a(q,{background:"",layout:"prev, pager, next, jumper","current-page":g.value,"page-size":f.value,total:p.value,onCurrentChange:U,style:{"margin-right":"8px"}},null,8,["current-page","page-size","total"])])]),_:1})}}},rt=K(lt,[["__scopeId","data-v-a8518ab7"]]);export{rt as default};
