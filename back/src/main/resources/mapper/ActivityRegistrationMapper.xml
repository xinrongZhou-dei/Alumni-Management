<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alumni.back.activity.ActivityRegistrationMapper">
    <insert id="insertRegistration" parameterType="com.alumni.back.Entity.ActivityRegistration">
        INSERT INTO activity_registration (
            alumni_id, activity_uuid, salutation, first_name, last_name, chinese_name, email, contact_number, wechat_id, correspondence_address, current_location, companions, payment_proof, created_at
        ) VALUES (
            #{alumniId}, #{activityUuid}, #{salutation}, #{firstName}, #{lastName}, #{chineseName}, #{email}, #{contactNumber}, #{wechatId}, #{correspondenceAddress}, #{currentLocation}, #{companions}, #{paymentProof}, NOW()
        )
    </insert>

    <select id="getRegistration" resultType="com.alumni.back.Entity.ActivityRegistration">
        SELECT 
            alumni_id as alumniId,
            activity_uuid as activityUuid,
            salutation,
            first_name as firstName,
            last_name as lastName,
            chinese_name as chineseName,
            email,
            contact_number as contactNumber,
            wechat_id as wechatId,
            correspondence_address as correspondenceAddress,
            current_location as currentLocation,
            companions,
            payment_proof as paymentProof,
            created_at as createdAt,
            updated_at as updatedAt
        FROM activity_registration
        WHERE alumni_id = #{alumniId} AND activity_uuid = #{activityUuid}
    </select>

    <select id="countByActivityUuid" resultType="int">
        SELECT COUNT(*) FROM activity_registration WHERE activity_uuid = #{activityUuid}
    </select>

    <select id="batchSelectFields" resultType="map">
        SELECT
        <foreach collection="fields" item="field" separator=",">
            ${field}
        </foreach>
        , alumni_id
        FROM activity_registration
        WHERE alumni_id IN
        <foreach collection="alumniIds" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <select id="getRegistrationsByActivityUuid" resultType="com.alumni.back.Entity.ActivityRegistration">
        SELECT 
            alumni_id as alumniId,
            activity_uuid as activityUuid,
            salutation,
            first_name as firstName,
            last_name as lastName,
            chinese_name as ChineseName,
            email,
            contact_number as contactNumber,
            wechat_id as wechatId,
            correspondence_address as correspondenceAddress,
            current_location as currentLocation,
            companions,
            payment_proof as paymentProof,
            created_at as createdAt,
            updated_at as updatedAt
        FROM activity_registration
        WHERE activity_uuid = #{activityUuid}
    </select>
</mapper> 